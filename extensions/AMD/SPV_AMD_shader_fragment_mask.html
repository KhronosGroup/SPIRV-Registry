<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>SPV_AMD_shader_fragment_mask</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";

p {
    font-family: Arial, Helvetica, sans-serif;
    line-height: normal;
}
em, b, strong {
    color: darkblue;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>SPV_AMD_shader_fragment_mask</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_name_strings">Name Strings</a></li>
<li><a href="#_contact">Contact</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_notice">Notice</a></li>
<li><a href="#_status">Status</a></li>
<li><a href="#_version">Version</a></li>
<li><a href="#_dependencies">Dependencies</a></li>
<li><a href="#_overview">Overview</a></li>
<li><a href="#_new_instructions">New Instructions</a></li>
<li><a href="#_modifications_to_the_spir_v_specification_version_1_1">Modifications to the SPIR-V Specification, Version 1.1</a></li>
<li><a href="#_validation_rules">Validation Rules</a></li>
<li><a href="#_issues">Issues</a></li>
<li><a href="#_revision_history">Revision History</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_name_strings">Name Strings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SPV_AMD_shader_fragment_mask</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contact">Contact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To report problems with this extension, please open a new issue at:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/KhronosGroup/SPIRV-Registry" class="bare">https://github.com/KhronosGroup/SPIRV-Registry</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributors">Contributors</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Aaron Hagan, AMD</p>
</li>
<li>
<p>Daniel Rakos, AMD</p>
</li>
<li>
<p>Rex Xu, AMD</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notice">Notice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright (c) 2017 The Khronos Group Inc. Copyright terms at
<a href="http://www.khronos.org/registry/speccopyright.html" class="bare">http://www.khronos.org/registry/speccopyright.html</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_status">Status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Draft.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_version">Version</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Modified Date: August 16, 2017
Revision:      1</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dependencies">Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension is written against Revision 1 of the version 1.12 of the
SPIR-V Specification.</p>
</div>
<div class="paragraph">
<p>The extension is written against Revision 1 of the OpenGL extension
AMD_shader_fragment_mask.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension is written to provide the functionality of the
AMD_shader_fragment_mask, OpenGL Shading Language Specification extension,
for SPIR-V.</p>
</div>
<div class="paragraph">
<p>This extension introduces two core instructions to SPIR-V that enable fetching
the fragment mask of compressed multisampled color surfaces, and an instruction
for sampling the surface with the fragment mask.</p>
</div>
<div class="paragraph">
<p>Extension Name</p>
</div>
<div class="listingblock">
<div class="content">
<pre>To use this extension within a SPIR-V module, the following OpExtension must be
present in the module:

----
OpExtension "SPV_AMD_shader_fragment_mask"
----

New Capabilities</pre>
</div>
</div>
<div class="paragraph">
<p>This extension introduces a new capability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FragmentMaskAMD = 5010</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_instructions">New Instructions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension adds the following core instructions</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OpFragmentMaskFetchAMD = 5011
OpFragmentFetchAMD     = 5012</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_modifications_to_the_spir_v_specification_version_1_1">Modifications to the SPIR-V Specification, Version 1.1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Modify Section 3.32.10, Image Instructions</p>
</div>
<div class="paragraph">
<p>Add the following items to the instruction sections.</p>
</div>
<div class="sect2">
<h3 id="_opfragmentmaskfetchamd">OpFragmentMaskFetchAMD</h3>
<div class="paragraph">
<p>The fragment mask can be fetched from a compressed multisampled color surface with a
call to fragmentMaskFetchAMD in the shader.  The returned value is a single unsigned
integer where each subsequent 4 bit specifies the color fragment index corresponding
to the color sample, starting from the least significant bit.</p>
</div>
<div class="paragraph">
<p><em>Result Type</em> must be a 32-bit unsigned integer type scalar.</p>
</div>
<div class="paragraph">
<p><em>Image</em> must be an object whose type is OpTypeImage with MS of 1. Dim must be 2D or SubpassData</p>
</div>
<div class="paragraph">
<p><em>Coordinate</em> is an integer scalar or vector containing (u[, v] &#8230;&#8203; [, array layer])
as needed by the deﬁnition of Sampled Image. When the Image Dim operand is SubpassData,
Coordinate is relative to the current fragment location. That is, the integer value
(rounded down) of the current fragment’s window-relative (x, y) coordinate is added to (u, v).</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;id&gt; Result Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result &lt;id&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;id&gt; Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;id&gt; Coordinate</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_opfragmentfetchamd">OpFragmentFetchAMD</h3>
<div class="paragraph">
<p>The color fragment for a particular sample can be fetched using the coorespondng fragment
mask index and calling fragmentFetchAMD.</p>
</div>
<div class="paragraph">
<p><em>Result Type</em> must be a vector of four components of ﬂoating-point type or integer type.
Its components must be the same as Sampled Type of the underlying OpTypeImage (unless that
underlying Sampled Type isOpTypeVoid).</p>
</div>
<div class="paragraph">
<p><em>Image</em> must be an object whose type is OpTypeImage with MS of 1. Dim must be 2D or SubpassData</p>
</div>
<div class="paragraph">
<p><em>Coordinate</em> is an integer scalar or vector containing (u[, v] &#8230;&#8203; [, array layer])
as needed by the deﬁnition of Sampled Image. When the Image Dim operand is SubpassData,
Coordinate is relative to the current fragment location. That is, the integer value
(rounded down) of the current fragment’s window-relative (x, y) coordinate is added to (u, v).</p>
</div>
<div class="paragraph">
<p><em>Fragment Index</em> fragment mask index used to sample the color fragment</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5012</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;id&gt; Result Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result &lt;id&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;id&gt; Image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;id&gt; Coordinate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;id&gt; Fragment Index</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_validation_rules">Validation Rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>None.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues">Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>None</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history">Revision History</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-rows stripes-even stretch">
<colgroup>
<col style="width: 5%;">
<col style="width: 10%;">
<col style="width: 15%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rev</th>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Author</th>
<th class="tableblock halign-left valign-top">Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">August 16, 2017</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aaron Hagan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial revision based on SPV_AMD_shader_fragment_mask.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
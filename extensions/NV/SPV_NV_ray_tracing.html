<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>SPV_NV_ray_tracing</title>
<style>
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
@import "https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css";

p {
    font-family: Arial, Helvetica, sans-serif;
    line-height: normal;
}
em, b, strong {
    color: darkblue;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>SPV_NV_ray_tracing</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_name_strings">Name Strings</a></li>
<li><a href="#_contact">Contact</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_status">Status</a></li>
<li><a href="#_version">Version</a></li>
<li><a href="#_dependencies">Dependencies</a></li>
<li><a href="#_overview">Overview</a></li>
<li><a href="#_extension_name">Extension Name</a></li>
<li><a href="#_new_execution_models">New Execution Models</a></li>
<li><a href="#_new_capabilities">New Capabilities</a></li>
<li><a href="#_new_storage_classes">New Storage Classes</a></li>
<li><a href="#_new_builtins">New Builtins</a></li>
<li><a href="#_new_instructions">New Instructions</a></li>
<li><a href="#_modifications_to_the_spir_v_specification_version_1_1">Modifications to the SPIR-V Specification, Version 1.1</a></li>
<li><a href="#_validation_rules">Validation Rules</a></li>
<li><a href="#_issues">Issues</a></li>
<li><a href="#_revision_history">Revision History</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_name_strings">Name Strings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SPV_NV_ray_tracing</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contact">Contact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>See <strong>Issues</strong> list in the Khronos SPIRV-Registry repository:
<a href="https://github.com/KhronosGroup/SPIRV-Registry" class="bare">https://github.com/KhronosGroup/SPIRV-Registry</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributors">Contributors</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Eric Werness, NVIDIA</p>
</li>
<li>
<p>Ashwin Lele, NVIDIA</p>
</li>
<li>
<p>Daniel Koch, NVIDIA</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_status">Status</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Complete</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_version">Version</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last Modified Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-09-17</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_dependencies">Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension is written against the SPIR-V Specification,
Version 1.1 Revision 4.</p>
</div>
<div class="paragraph">
<p>This extension requires SPIR-V 1.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension adds new functionality to support the Vulkan
VK_NV_ray_tracing extension in SPIR-V.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extension_name">Extension Name</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use this extension within a SPIR-V module, the following
<strong>OpExtension</strong> must be present in the module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OpExtension "SPV_NV_ray_tracing"</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_execution_models">New Execution Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension introduces new execution models:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>RayGenerationNV
IntersectionNV
AnyHitNV
ClosestHitNV
MissNV
CallableNV</pre>
</div>
</div>
<div class="paragraph">
<p>these depend on the <strong>RayTracingNV</strong> capability.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_capabilities">New Capabilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension introduces new capabilities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>RayTracingNV</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_storage_classes">New Storage Classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Storage classes added under the <strong>RayTracingNV</strong> capability</p>
</div>
<div class="listingblock">
<div class="content">
<pre>RayPayloadNV
IncomingRayPayloadNV
HitAttributeNV
CallableDataNV
IncomingCallableDataNV
ShaderRecordBufferNV</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_builtins">New Builtins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Builtins added under the <strong>RayTracingNV</strong> capability</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LaunchIdNV
LaunchSizeNV
InstanceCustomIndexNV
WorldRayOriginNV
WorldRayDirectionNV
ObjectRayOriginNV
ObjectRayDirectionNV
RayTminNV
RayTmaxNV
ObjectToWorldNV
WorldToObjectNV
HitTNV
HitKindNV
IncomingRayFlagsNV</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_instructions">New Instructions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instructions added under the <strong>RayTracingNV</strong> capability</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OpReportIntersectionNV
OpIgnoreIntersectionNV
OpTerminateRayNV
OpTraceNV
OpTypeAccelerationStructureNV
OpExecuteCallableNV</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_modifications_to_the_spir_v_specification_version_1_1">Modifications to the SPIR-V Specification, Version 1.1</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">(Modify Section 2.2.2, Types ) </dt>
<dd>
<div class="paragraph">
<p>add <strong>OpTypeAccelerationStructureNV</strong> to list of opaque types</p>
</div>
</dd>
<dt class="hdlist1">(Modify Section 3.3, Execution Model, adding rows to the Execution Model table) </dt>
<dd>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 3.5714%;">
<col style="width: 42.8571%;">
<col style="width: 53.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle" colspan="2">Execution Model</th>
<th class="tableblock halign-left valign-top">Enabling Capabilities</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5313</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayGenerationNV</strong><br>
Ray generation shading stage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5314</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IntersectionNV</strong> <br>
Intersection shading stage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5315</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AnyHitNV</strong><br>
Any hit shading stage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5316</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ClosestHitNV</strong><br>
Closest hit shading stage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5317</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MissNV</strong><br>
Miss shading stage.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5318</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CallableNV</strong><br>
Ray callable shading stage.<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
<dt class="hdlist1">(Modify Section 3.7, Storage Class, adding rows to the Storage Class table) </dt>
<dd>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 66.6666%;">
<col style="width: 13.3333%;">
<col style="width: 13.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle" colspan="2">Storage Class</th>
<th class="tableblock halign-left valign-top"><a href="#Capability">Enabling Capabilities</a></th>
<th class="tableblock halign-left valign-top">Enabled by Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5328</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CallableDataNV</strong><br>
Used for storing arbitrary data associated with a ray to pass to callables.
Visible across all functions in the current invocation. Not shared externally. Variables declared
with this storage class can be both read and written to. Only allowed in <strong>RayGenerationNV</strong>,
<strong>ClosestHitNV</strong>, <strong>CallableNV</strong>, and <strong>MissNV</strong> execution models.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPV_NV_ray_tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5329</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IncomingCallableDataNV</strong><br>
Used for storing arbitrary data from parent sent to current callable stage invoked from
an executeCallable call. Visible across all functions in current invocation. Not shared externally.
Variables declared with the storage class are allowed only in <strong>CallableNV</strong> execution models.
Can be both read and written to in above execution models.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPV_NV_ray_tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5338</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayPayloadNV</strong><br>
Used for storing payload data associated with a ray. Visible across all functions in
the current invocation. Not shared externally. Variables declared
with this storage class can be both read and written to. Only allowed in <strong>RayGenerationNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong> and <strong>MissNV</strong> execution models.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPV_NV_ray_tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5339</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HitAttributeNV</strong><br>
Used for storing attributes of geometry intersected by a ray. Visible across all
functions in the current invocation. Not shared externally. Variables declared with this
storage class are allowed only in <strong>IntersectionNV</strong>, <strong>AnyHitNV</strong> and <strong>ClosestHitNV</strong> execution models.
They can be written to only in <strong>IntersectionNV</strong> execution model and read from only
in <strong>AnyHitNV</strong> and <strong>ClosestHitNV</strong> execution models.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPV_NV_ray_tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5342</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IncomingRayPayloadNV</strong><br>
Used for storing parent payload data associated with a ray in current stage invoked from
a trace call. Visible across all functions in current invocation. Not shared externally.
Variables declared with the storage class are allowed only in <strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong> and
<strong>MissNV</strong> execution models. Can be both read and written to in above execution models.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPV_NV_ray_tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5343</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ShaderRecordBufferNV</strong><br>
Used for storing data in shader record associated with each unique shader in ray_tracing
pipeline. Visible across all functions in current invocation. Can be initialized externally via API.
Variables declared with this storage class are allowed in <strong>RayGenerationNV</strong>, <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>, <strong>MissNV</strong> and <strong>CallableNV</strong> execution models and can be both read and written to
but cannot have initializers. Refer to the Ray Tracing chapter of Vulkan API specification for details on shader records.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPV_NV_ray_tracing</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
<dt class="hdlist1">(Modify Section 3.20, Decoration) </dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Modify the definition of the <strong>Location</strong> decoration to add:</p>
</div>
<div class="paragraph">
<p><strong>Location</strong> also forms the linkage between:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OpTraceNV</strong> and the <strong>RayPayloadKHR</strong> and <strong>IncomingRayPayloadKHR</strong> Storage Classes</p>
</li>
<li>
<p><strong>OpExecuteCallableNV</strong> and the <strong>CallableDataKHR</strong> and <strong>IncomingCallableDataKHR</strong> Storage Classes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Add <strong>RayPayloadKHR</strong>, <strong>IncomingRayPayloadKHR</strong>, <strong>CallableDataKHR</strong>, and <strong>IncomingCallableDataKHR</strong>
to the list of Storage Classes that <strong>Location</strong> is valid on.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">(Modify Section 3.21, Builtin, adding rows to the Builtin table) </dt>
<dd>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 4.7619%;">
<col style="width: 47.619%;">
<col style="width: 28.5714%;">
<col style="width: 9.5238%;">
<col style="width: 9.5239%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle" colspan="2">Decoration</th>
<th class="tableblock halign-left valign-top"><a href="#Capability">Enabling Capabilities</a></th>
<th class="tableblock halign-left valign-middle" colspan="2">Extra Operands</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5319</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>LaunchIdNV</strong><br>
Index of work item being processed in current invocation of ray tracing shader stage.
Allowed in all ray tracing execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>LaunchSizeNV</strong><br>
Width and height dimensions passed to vkCmdTraceRaysNV call which resulted in invocation of
current ray tracing shader stage. Allowed in all ray tracing execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5321</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WorldRayOriginNV</strong><br>
World-space origin coordinates for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>, or <strong>MissNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5322</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WorldRayDirectionNV</strong><br>
World-space direction for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>, or <strong>MissNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5323</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ObjectRayOriginNV</strong><br>
Object-space origin coordinates for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>, or <strong>MissNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5324</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ObjectRayDirectionNV</strong><br>
Object-space direction for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>, or <strong>MissNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5325</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTminNV</strong><br>
The current <strong>Tmin</strong> parametric value for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>, or <strong>MissNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5326</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTmaxNV</strong><br>
The current <strong>Tmax</strong> parametric value for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>, or <strong>MissNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5327</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>InstanceCustomIndexNV</strong><br>
Application specified value associated with the instance that was hit by the current ray in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5330</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ObjectToWorldNV</strong><br>
The <em>4x3</em> object to world transformation matrix for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, or <strong>ClosestHitNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5331</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WorldToObjectNV</strong><br>
The <em>4x3</em> world to object transformation matrix for the ray being traced in the <strong>IntersectionNV</strong>,
<strong>AnyHitNV</strong>, or <strong>ClosestHitNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5332</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HitTNV</strong><br>
The parametric value <strong>T</strong> for the ray resulting in a hit for the ray being traced in the <strong>AnyHitNV</strong> or
<strong>ClosestHitNV</strong> execution models. This is an alias for RayTMaxNV for convenience.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5333</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HitKindNV</strong><br>
The hit kind of the hit for the ray being traced in the <strong>AnyHitNV</strong> or
<strong>ClosestHitNV</strong> execution models.</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5351</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IncomingRayFlagsNV</strong><br>
The ray flags in current stage as passed in through trace call in parent. Available in <strong>AnyHitNV</strong>,
<strong>ClosestHitNV</strong>, <strong>IntersectionNV</strong>, and <strong>MissNV</strong> stage</p>
<p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification for more details.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
<dt class="hdlist1">(Modify the definition of following BuiltIns, allowing them to be used in <strong>IntersectionNV</strong>, <strong>AnyHitNV</strong>, or <strong>ClosestHitNV</strong> Execution Models.)</dt>
<dd>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 40%;">
<col style="width: 16%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle" colspan="2">BuiltIn</th>
<th class="tableblock halign-center valign-top">Enabling Capabilities</th>
<th class="tableblock halign-center valign-top">Enabled by Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>InstanceId</strong><br>
Input Instance identifier. See the client API specifications
for more detail.</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Instance ID in a <strong>Vertex</strong> Execution Model</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Shader</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Instance ID in an <strong>IntersectionNV</strong>, <strong>AnyHitNV</strong>, or <strong>ClosestHitNV</strong> Execution Model</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>SPV_NV_ray_tracing</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="4"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PrimitiveId</strong><br>
Primitive identifier. See the client API specifications for more detail.</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Primitive ID in a <strong>Geometry</strong> Execution Model</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Geometry</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Primitive ID in a <strong>Tessellation</strong> Execution Model</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Tessellation</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle"><p class="tableblock">Primitive ID in an <strong>IntersectionNV</strong>, <strong>AnyHitNV</strong>, or <strong>ClosestHitNV</strong> Execution Model</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>RayTracingNV</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>SPV_NV_ray_tracing</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
<dt class="hdlist1">(Modify Section 3.31, Capability, adding a row to the Capability table) </dt>
<dd>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 2.0408%;">
<col style="width: 51.0204%;">
<col style="width: 16.3265%;">
<col style="width: 30.6123%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle" colspan="2">Capability</th>
<th class="tableblock halign-left valign-top">Depends On</th>
<th class="tableblock halign-center valign-top">Enabled by Extension</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5340</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RayTracingNV</strong><br>
Uses the <strong>RayGenerationNV</strong>, <strong>IntersectionNV</strong>, <strong>AnyHitNV</strong>, <strong>ClosestHitNV</strong>,
<strong>MissNV</strong>, or <strong>CallableNV</strong> Execution Models</p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SPV_NV_ray_tracing</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
<dt class="hdlist1">(Modify Section 3.32.6, Type-Declaration Instructions, adding a new table) </dt>
<dd>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 55.5555%;">
<col style="width: 11.1111%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><a id="OpTypeAccelerationStructureNV"></a><strong>OpTypeAccelerationStructureNV</strong><br>
<br>
Declares an acceleration structure type which is an opaque reference to
acceleration structure handle as defined in the Ray Tracing chapter of Vulkan API
specification.</p>
<p class="tableblock">Consumed by <strong>OpTraceNV</strong></p>
<p class="tableblock">This type is opaque: values of this type have no defined physical size or
bit pattern.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability:<br>
<strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5341</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Result</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
<dt class="hdlist1">(Add a new sub section 3.32.24, Ray Tracing Instructions, adding to end of list of instructions) </dt>
<dd>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5714%;">
<col style="width: 8.5718%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="12"><p class="tableblock"><a id="OpTraceNV"></a><strong>OpTraceNV</strong><br>
<br>
 Trace a ray into the acceleration structure.<br>
<br>
 <em>Acceleration Structure</em> is the descriptor for the acceleration structure to trace into.<br>
<br>
 <em>Ray Flags</em> controls the properties for the trace. See the Ray Tracing chapter of Vulkan API specification for more details.<br>
<br>
 <em>Cull Mask</em> is the 8-bit mask for test against the instance mask.<br>
<br>
 <em>SBT Offset</em> and <em>SBT Stride</em> control indexing into the SBT for hit shaders called from this trace.
 <em>SBT</em> stands for Shader Binding Table. Refer to the Ray Tracing chapter of Vulkan API specification for details.<br>
<br>
 <em>Miss Index</em> is the index of the miss shader to be called from this trace call.<br>
<br>
 <em>Ray Origin</em>, <em>Ray Tmin</em>, <em>Ray Direction</em>, and <em>Ray Tmax</em> control the basic parameters of the ray to be traced.<br>
<br>
 <em>Payload number</em> matches the declared location of the payload structure to use for this trace.<br>
<br>
 <em>Ray Flags</em>, <em>Cull Mask</em>, <em>SBT Offset</em>, <em>SBT Stride</em>, and <em>Miss Index</em> must be a 32-bit <em>integer type</em> scalar.<br>
<br>
 <em>Ray Origin</em> and <em>Ray Direction</em> must be a 32-bit <em>float type</em> 3-component vector.<br>
<br>
 <em>Ray Tmin</em> and <em>Ray Tmax</em> must be a 32-bit <em>float type</em> scalar.<br>
<br>
 This instruction is allowed only in <strong>RayGenerationNV</strong>, <strong>ClosestHitNV</strong> and <strong>MissNV</strong> execution models.<br>
<br></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability:<br>
<strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5337</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt; Acceleration Structure</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt; Ray Flags</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Cull Mask</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>SBT Offset</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>SBT Stride</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Miss Index</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Ray Origin</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Ray Tmin</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Ray Direction</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Ray Tmax</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Payload number</em></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 21.4285%;">
<col style="width: 21.4285%;">
<col style="width: 21.4289%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock"><a id="OpReportIntersectionNV"></a><strong>OpReportIntersectionNV</strong><br>
<br>
Reports an intersection back to the traversal infrastructure.</p>
<p class="tableblock"><em>Hit</em> is the floating point parametric value along ray for the intersection.</p>
<p class="tableblock"><em>Hit Kind</em> is the integer hit kind reported back to other shaders and accessible by the hit kind builtin.</p>
<p class="tableblock"><em>Result Type</em> must be a scalar boolean.</p>
<p class="tableblock"><em>Hit</em> must be a 32-bit <em>float type</em> scalar.</p>
<p class="tableblock"><em>Hit Kind</em> must be a 32-bit <em>unsigned integer type</em> scalar.</p>
<p class="tableblock">This instruction is allowed only in <strong>IntersectionNV</strong> execution model.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability:<br>
<strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5334</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Result Type</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Result</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Hit</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Hit Kind</em></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OpIgnoreIntersectionNV"></a><strong>OpIgnoreIntersectionNV</strong><br>
<br>
Ignores the current potential intersection.</p>
<p class="tableblock">This instruction is allowed only in <strong>AnyHitNV</strong> execution model.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability:<br>
<strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5335</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OpTerminateRayNV"></a><strong>OpTerminateRayNV</strong><br>
<br>
Terminates further traversal of a ray.</p>
<p class="tableblock">This instruction is allowed only in <strong>AnyHitNV</strong> execution model.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability:<br>
<strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5336</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 33.3335%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><a id="OpExecuteCallableNV"></a><strong>OpExecuteCallableNV</strong><br>
<br>
Invoke a callable shader</p>
<p class="tableblock"><em>SBT Index</em> is the index into the SBT table to select callable shader to execute</p>
<p class="tableblock"><em>Callable Data Number</em> matches the declared location of the callable data to pass into through this call</p>
<p class="tableblock">This instruction is allowed only in <strong>RayGenerationNV</strong>, <strong>ClosestHitNV</strong>, <strong>MissNV</strong> and <strong>CallableNV</strong> execution models.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capability:<br>
<strong>RayTracingNV</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5344</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>SBT Index</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;id&gt;</em> <em>Callable Data Number</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_validation_rules">Validation Rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An OpExtension must be added to the SPIR-V for validation layers to check
legal use of this extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OpExtension "SPV_NV_ray_tracing"</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues">Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>None yet!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history">Revision History</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 4.7619%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rev</th>
<th class="tableblock halign-left valign-top">Date</th>
<th class="tableblock halign-left valign-top">Author</th>
<th class="tableblock halign-left valign-top">Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-09-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Werness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Internal revisions</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-10-19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ashwin Lele</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rename from NVX_raytracing to NV_ray_tracing.
                              Add IncomingRayFlagsNV, CallableDataNV,
                              IncomingCallableDataNV, OpExecuteCallableNV</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2018-11-20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel Koch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uses InstanceId not InstanceIndex for
                              Intersection, Any Hit and Closest Hit shaders</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2019-03-25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eric Werness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incoming ray flags shouldn&#8217;t be exposed in
                              Callable shaders</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-09-17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daniel Koch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add edits for the Location decoration (SPIR #583)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</body>
</html>
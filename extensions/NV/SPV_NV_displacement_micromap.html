<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Asciidoctor 1.5.4">
  <title>SPV_NV_displacement_micromap</title>
  <link rel="stylesheet" href="https://asciidoclive.com/assets/asciidoctor.js/css/asciidoctor.css">
</head>

<body class="article">
  <div id="header">
    <h1>SPV_NV_displacement_micromap</h1>
  </div>
  <div id="content">
    <div class="sect1">
      <h2 id="_name_strings">Name Strings</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>SPV_NV_displacement_micromap</p>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_contact">Contact</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>See <strong>Issues</strong> list in the Khronos SPIRV-Registry repository:
            <a href="https://github.com/KhronosGroup/SPIRV-Registry" class="bare">https://github.com/KhronosGroup/SPIRV-Registry</a></p>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_contributors">Contributors</h2>
      <div class="sectionbody">
        <div class="ulist">
          <ul>
            <li>
              <p>Eric Werness, NVIDIA</p>
            </li>
            <li>
              <p>Ashwin Lele, NVIDIA</p>
            </li>
            <li>
              <p>Pyarelal Knowles, NVIDIA</p>
            </li>
            <li>
              <p>Christoph Kubisch, NVIDIA</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_status">Status</h2>
      <div class="sectionbody">
        <div class="ulist">
          <ul>
            <li>
              <p>Provisional</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_version">Version</h2>
      <div class="sectionbody">
        <table class="tableblock frame-all grid-all" style="width: 40%;">
          <colgroup>
            <col style="width: 50%;">
            <col style="width: 50%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Last Modified Date</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">2023-08-01</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Revision</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">1</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_dependencies">Dependencies</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>This extension is written against the SPIR-V Specification, Version 1.5
            Revision 1.</p>
        </div>
        <div class="paragraph">
          <p>This extension requires SPIR-V 1.4.</p>
        </div>
        <div class="paragraph">
          <p>This extension interacts with SPV_KHR_ray_tracing, SPV_NV_mesh_shader,
            SPV_EXT_mesh_shader.
          </p>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_overview">Overview</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>This extension adds new functionality to support the Vulkan VK_NV_displacement_micromap
            extension in SPIR-V.</p>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_extension_name">Extension Name</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>To use this extension within a SPIR-V module, the following
            <strong>OpExtension</strong> must be present in the module:</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre>OpExtension "SPV_NV_displacement_micromap"</pre>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_new_capabilities">New Capabilities</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>This extension introduces new capabilities:</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre>DisplacementMicromapNV
RayTracingDisplacementMicromapNV</pre>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_new_builtins">New Builtins</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>Builtins added under the <strong>RayTracingDisplacementMicromapNV</strong>            capability</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre>HitMicroTriangleVertexPositionsNV
HitMicroTriangleVertexBarycentricsNV
HitKindFrontFacingMicroTriangleNV
HitKindBackFacingMicroTriangleNV</pre>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_new_instructions">New Instructions</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>Instructions added under the <strong>DisplacementMicromapNV</strong> capability</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre>OpFetchMicroTriangleVertexPositionNV
OpFetchMicroTriangleVertexBarycentricNV</pre>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_modifications_to_the_spir_v_specification_version_1_1">Modifications to the SPIR-V Specification, Version 1.1</h2>
      <div class="sectionbody">
        <div class="dlist">
          <dl>
            <dt class="hdlist1">(Modify Section 2.2.2, Types ) </dt>
            <dd>
              <div class="paragraph">
                <p>add <strong>OpTypeAccelerationStructureNV</strong> to list of opaque
                  types</p>
              </div>
            </dd>
            <dt class="hdlist1">(Modify Section 3.21, Builtin, adding rows to the Builtin table) </dt>
            <dd>
              <div class="openblock">
                <div class="content">
                  <table class="tableblock frame-all grid-all spread">
                    <colgroup>
                      <col style="width: 11.1111%;">
                      <col style="width: 22.2222%;">
                      <col style="width: 22.2222%;">
                      <col style="width: 22.2222%;">
                      <col style="width: 22.2223%;">
                    </colgroup>
                    <thead>
                      <tr>
                        <th class="tableblock halign-center valign-middle" colspan="2">Decoration</th>
                        <th class="tableblock halign-left valign-top"><a href="#Capability">Enabling Capabilities</a></th>
                        <th class="tableblock halign-left valign-middle" colspan="2">Extra Operands</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">5337</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>HitMicroTriangleVertexPositionsNV</strong><br>                            The vertex positions for a hit with a microtriangle for
                            the ray being traced.
                          </p>
                          <p class="tableblock">Allowed in <strong>AnyHitKHR</strong> and <strong>ClosestHitKHR</strong>                            stages.</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>RayTracingDisplacementMicromapNV</strong></p>
                        </td>
                        <td class="tableblock halign-left valign-top" colspan="2"></td>
                      </tr>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">5344</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>HitMicroTriangleVertexBarycentricsNV</strong><br>                            The barycentric coordinates for vertices of a microtriangle
                            hit for the ray being traced relative to the base triangle&#8217;s
                            vertices.
                          </p>
                          <p class="tableblock">Allowed in <strong>AnyHitKHR</strong> and <strong>ClosestHitKHR</strong>                            stages.
                          </p>
                          <p class="tableblock">Refer to the Ray Tracing chapter of Vulkan API specification
                            for more details.</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>RayTracingDisplacementMicromapNV</strong></p>
                        </td>
                        <td class="tableblock halign-left valign-top" colspan="2"></td>
                      </tr>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">5405</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>HitKindFrontFacingMicroTriangleNV</strong><br>                            A link-time constant that <strong>HitKindKHR</strong>                            will return when <strong>OpTraceRayKHR</strong> intersects
                            a front facing microtriangle.
                          </p>
                          <p class="tableblock">Allowed in all stages.</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>RayTracingDisplacementMicromapNV</strong></p>
                        </td>
                        <td class="tableblock halign-left valign-top" colspan="2"></td>
                      </tr>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">5406</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>HitKindBackFacingMicroTriangleNV</strong><br> A
                            link-time constant that <strong>HitKindKHR</strong> will
                            return when <strong>OpTraceRayKHR</strong> intersects
                            a back facing microtriangle.
                          </p>
                          <p class="tableblock">Allowed in all stages.</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>RayTracingDisplacementMicromapNV</strong></p>
                        </td>
                        <td class="tableblock halign-left valign-top" colspan="2"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </dd>
            <dt class="hdlist1">(Modify Section 3.HK, Hit Kinds, adding rows to the table) </dt>
            <dd>
              <div class="openblock">
                <div class="content">
                  <div id="hit_kinds" class="paragraph">
                    <p><strong>3.HK, Hit Kinds</strong></p>
                  </div>
                  <div class="paragraph">
                    <p>Values returned in the variable decorated as <strong>HitKindKHR</strong>                      from built-in intersections with triangle geometry.</p>
                  </div>
                  <table class="tableblock frame-all grid-all spread">
                    <colgroup>
                      <col style="width: 6.8965%;">
                      <col style="width: 41.3793%;">
                      <col style="width: 51.7242%;">
                    </colgroup>
                    <thead>
                      <tr>
                        <th class="tableblock halign-left valign-top">Value<sup>.</sup></th>
                        <th class="tableblock halign-left valign-top">Hit Kind</th>
                        <th class="tableblock halign-left valign-top">Enabling Capabilities</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">builtin</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>HitKindFrontFacingMicroTriangleNV</strong><br>                            The intersection was with front-facing displacement micromap
                            geometry.</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>RayTracingDisplacementMicromapNV</strong></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">builtin</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>HitKindBackFacingMicroTriangleKHR</strong><br>                            The intersection was with back-facing displacement micromap
                            geometry.</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>RayTracingDisplacementMicromapNV</strong></p>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </dd>
            <dt class="hdlist1">(Modify Section 3.31, Capability, adding a row to the Capability table) </dt>
            <dd>
              <div class="openblock">
                <div class="content">
                  <table class="tableblock frame-all grid-all spread">
                    <colgroup>
                      <col style="width: 33.3333%;">
                      <col style="width: 33.3333%;">
                      <col style="width: 33.3334%;">
                    </colgroup>
                    <thead>
                      <tr>
                        <th class="tableblock halign-center valign-middle" colspan="2">Capability</th>
                        <th class="tableblock halign-left valign-top">Implicitly declares</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">5380</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>DisplacementMicromapNV</strong><br> Uses the <strong>OpFetchMicroTriangleVertexPositionNV</strong>                            or <strong>OpFetchMicroTriangleVertexBarycentricNV</strong>                            instructions</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>Shader</strong></p>
                        </td>
                      </tr>
                      <tr>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">5409</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>RayTracingDisplacementMicromapNV</strong><br> Uses
                            either of <strong>HitMicroTriangleVertexPositionsNV</strong>,
                            <strong>HitMicroTriangleVertexBarycentricsNV</strong>,
                            <strong>HitKindFrontFacingMicroTriangleNV</strong>,
                            <strong>HitKindBackFacingMicroTriangleNV</strong> , <strong>HitKindFrontFacingMicroTriangleNV</strong>                            or
                            <strong>HitKindBackFacingMicroTriangleKHR</strong> builtins</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock"><strong>Shader</strong></p>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </dd>
            <dt class="hdlist1">(Modify Section 3.32.6, Type-Declaration Instructions, adding a new table) </dt>
            <dd>
              <div class="openblock">
                <div class="content">
                  <table class="tableblock frame-all grid-all spread">
                    <colgroup>
                      <col style="width: 5.8823%;">
                      <col style="width: 5.8823%;">
                      <col style="width: 17.647%;">
                      <col style="width: 17.647%;">
                      <col style="width: 17.647%;">
                      <col style="width: 17.647%;">
                      <col style="width: 17.6474%;">
                    </colgroup>
                    <tbody>
                      <tr>
                        <td class="tableblock halign-left valign-top" colspan="6">
                          <p class="tableblock">
                            <a id="OpTypeAccelerationStructureKHR"></a><strong>OpTypeAccelerationStructureKHR</strong><br>
                            <br> Declares an acceleration structure type which is
                            an opaque reference to acceleration structure handle
                            as defined in the client API specification.
                          </p>
                          <p class="tableblock">Consumed by <a href="#OpFetchMicroTriangleVertexPositionNV"><strong>OpFetchMicroTriangleVertexPositionNV</strong></a>                            and
                            <a href="#OpFetchMicroTriangleVertexBarycentricNV"><strong>OpFetchMicroTriangleVertexBarycentricNV</strong></a>
                          </p>
                          <p class="tableblock">This type is opaque: values of this type have no defined
                            physical size or bit pattern.</p>
                        </td>
                        <td class="tableblock halign-left valign-top">
                          <p class="tableblock">Capability:<br>
                            <strong>DisplacementMicromapNV</strong></p>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_instructions">Instructions</h2>
      <div class="sectionbody">
        <div class="dlist">
          <dl>
            <dt class="hdlist1">(Add the new instruction) </dt>
          </dl>
        </div>
        <table class="tableblock frame-all grid-all spread">
          <colgroup>
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1112%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top" colspan="8">
                <p class="tableblock">
                  <a id="OpFetchMicroTriangleVertexPositionNV"></a><strong>OpFetchMicroTriangleVertexPositionNV</strong><br>
                  <br> Returns the vertex position of a micro triangle in object
                  space.
                  <br>
                </p>
                <p class="tableblock"> <em>Result Type</em> must 3 component vector of 32-bit <em>floating point</em>                  type<br>
                  <br>
                  <em>Acceleration Structure</em> is the descriptor for the acceleration
                  structure to trace into.<br>
                  <br>
                  <em>Instance Id</em> must be an &lt;id&gt; of 32-bit scalar <em>integer type</em>.<br>
                  <br>
                  <em>Geometry Index</em> must be an &lt;id&gt; of 32-bit scalar
                  <em>integer type</em>.<br>
                  <br>
                  <em>Primitive Index</em> must be an &lt;id&gt; of 32-bit scalar
                  <em>integer type</em>.<br>
                  <br>
                  <em>Barycentrics</em> must be an &lt;id&gt; of 2 component vector
                  of <em>integer type</em>.<br>
                  <br> This instruction is allowed only in <strong>RayGenerationKHR</strong>,
                  <strong>MeshNV</strong> and <strong>GLCompute</strong> execution
                  models.<br></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Capability:<br>
                  <strong>DisplacementMicromapNV</strong></p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">7</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">5300</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt;</em> <em>Result Type</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>Result</em> <em>&lt;id&gt;</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Acceleration Structure</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Instance Id</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Geometry Index</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Primitive Index</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Barycentrics</em></p>
              </td>
            </tr>
          </tbody>
        </table>
        <table class="tableblock frame-all grid-all spread">
          <colgroup>
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1111%;">
            <col style="width: 11.1112%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top" colspan="8">
                <p class="tableblock">
                  <a id="OpFetchMicroTriangleVertexBarycentricNV"></a><strong>OpFetchMicroTriangleVertexBarycentricNV</strong><br>
                  <br> Returns the barycentric coordinates of a micro triangle vertex
                  relative to the base triangle vertices.
                  <br>
                </p>
                <p class="tableblock"> <em>Result Type</em> must 2 component vector of 32-bit <em>floating point</em>                  type<br>
                  <br>
                  <em>Acceleration Structure</em> is the descriptor for the acceleration
                  structure to trace into.<br>
                  <br>
                  <em>Instance Id</em> must be an &lt;id&gt; of 32-bit scalar <em>integer type</em>.<br>
                  <br>
                  <em>Geometry Index</em> must be an &lt;id&gt; of 32-bit scalar
                  <em>integer type</em>.<br>
                  <br>
                  <em>Primitive Index</em> must be an &lt;id&gt; of 32-bit scalar
                  <em>integer type</em>.<br>
                  <br>
                  <em>Barycentrics</em> must be an &lt;id&gt; of 2 component vector
                  of <em>integer type</em>.<br>
                  <br> This instruction is allowed only in <strong>RayGenerationKHR</strong>,
                  <strong>MeshNV</strong> and <strong>GLCompute</strong> execution
                  models.<br></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Capability:<br>
                  <strong>DisplacementMicromapNV</strong></p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">7</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">5301</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt;</em> <em>Result Type</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>Result</em> <em>&lt;id&gt;</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Acceleration Structure</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Instance Id</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Geometry Index</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Primitive Index</em></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><em>&lt;id&gt; Barycentrics</em></p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_validation_rules">Validation Rules</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>An OpExtension must be added to the SPIR-V for validation layers to check
            legal use of this extension:</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre>OpExtension "SPV_NV_displacement_micromap"</pre>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_issues">Issues</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>None yet!</p>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_revision_history">Revision History</h2>
      <div class="sectionbody">
        <table class="tableblock frame-all grid-rows spread">
          <colgroup>
            <col style="width: 5.6603%;">
            <col style="width: 14.1509%;">
            <col style="width: 14.1509%;">
            <col style="width: 66.0379%;">
          </colgroup>
          <thead>
            <tr>
              <th class="tableblock halign-left valign-top">Rev</th>
              <th class="tableblock halign-left valign-top">Date</th>
              <th class="tableblock halign-left valign-top">Author</th>
              <th class="tableblock halign-left valign-top">Changes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">1</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">2023-08-01</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Pyarelal Knowles</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><strong>Internal revisions</strong></p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>

</html>
